# -- Default number of instances to start 
replicaCount: 1
# -- Application name
name: issuer-api
# -- Ovverwrites application name
# nameOverride: "issuer-api"

image:
  repository: docker.io
  # -- Image name
  name: waltid/ssikit
  # -- Image tag
  # Uses .Chart.AppVersion if empty
  tag: "latest"
  # -- Image sha, usually generated by the CI
  # Uses image.tag if empty
  sha: ""
  # -- Image pull policy
  pullPolicy: IfNotPresent
  # -- Image pull secret when internal image is used
  #pullSecrets: deployment-key-light

## Use configMap or secretRef for environment variables
useConfigMap: false
configMapName: my-configmap
useSecretRef: false
secretRefName: my-secret

podAnnotations: {}

resources:
  requests:
    cpu: 150m
    memory: 128Mi
  limits:
    cpu: 300m
    memory: 256Mi

autoscaling:
  # -- Enable autoscaling
  enabled: false
  # -- Minimum replicas
  minReplicas: 2
  # -- Maximum replicas
  maxReplicas: 3
  # -- CPU target for autoscaling trigger
  targetCPUUtilizationPercentage: 70
  # -- Memory target for autoscaling trigger
  targetMemoryUtilizationPercentage: 70

metrics:
  # -- Enable prometheus metrics
  enabled: false #true
  # -- Port for prometheus metrics
  port: 2112

log:
  level: "debug"
  encoding: json

security:
  # -- by default, apps run as non-root
  runAsNonRoot: false
  # -- User used by the apps
  runAsUid: 0
  # -- Group used by the apps
  runAsGid: 0

config:
  persistance:
    size: 100Mi
  wallet:
    url: "http://waltid-wallet-api.default.svc.cluster.local:8080"
    account: 
      email: "wallet@ntt.com"
      pass: "xfsc4Ntt!"
  issuer:
    did: "did:web:dataspace4health.local:wallet:api:wallet-api:registry:0"
    proofType: "LD_PROOF"
    templatesFolder: "data/credential-store/templates"
  vault:
    url: http://waltid-wallet-api-vault-server-headless.default.svc.cluster.local:8200
    token: root
  http:
    host: ""
    ports:
      - name: core
        containerPort: 7000
      - name: issuer
        containerPort: 7001
      - name: wallet
        containerPort: 7002
      - name: verifier
        containerPort: 7003
      - name: essif
        containerPort: 7004
      - name: oidc
        containerPort: 7010
    timeout:
      idle: 120s
      read: 10s
      write: 10s
ingress:
  enabled: true
  hosts:
    - paths:
      # - path: /core/api
      #   port: 7000
      #   pathType: Prefix
      - path: /issuer/api
        port: 7001
        pathType: Prefix
      # - path: /wallet/api
      #   port: 7002
      #   pathType: Prefix
      - path: /verifier/api
        port: 7003
        pathType: Prefix
      # - path: /essif/api
      #   port: 7004
      #   pathType: Prefix
      - path: /openid4vc/api
        port: 7010
        pathType: Prefix
  replacePath:
    regex: /(core|issuer|wallet|verifier|essif|openid4vc)/api(/|$)(.*)
    replacement: /$3
  replaceHeader:
    header: Location
    regex: (/|^)swagger(.*)
    replacement: ./api/swagger$2
  replaceBody:
    regex: (href=|src=|['"]?url['"]?:\s?)(['"])?\/(v1|api-routes)?([^'"]*)(['"])?
    #replacement: $1$2${3:+.:..}/$3$4$5
    replacement: $1$2./$3$4$5
    logLevel: -2
    monitoring:
      methods:
      - GET
      types:
      - "*/*"
      - application/javascript
      - application/json
      - text/html
  tls:
    - secretName: dataspace4health.local
      hosts:
        - dataspace4health.local

# istio:
#   injection:
#     pod: true
