# -- Default number of instances to start 
replicaCount: 1
# -- Application name
name: issuer-api
# -- Ovverwrites application name
# nameOverride: "issuer"

image:
  repository: docker.io
  # -- Image name
  name: waltid/issuer-api
  # -- Image tag
  # Uses .Chart.AppVersion if empty
  tag: "1.0.2410242336-SNAPSHOT"
  # -- Image sha, usually generated by the CI
  # Uses image.tag if empty
  sha: ""
  # -- Image pull policy
  pullPolicy: IfNotPresent
  # -- Image pull secret when internal image is used
  #pullSecrets: deployment-key-light

## Use configMap or secretRef for environment variables
useConfigMap: false
configMapName: my-configmap
useSecretRef: false
secretRefName: my-secret

podAnnotations: {}

resources:
  requests:
    cpu: 150m
    memory: 128Mi
  limits:
    cpu: 300m
    memory: 256Mi

autoscaling:
  # -- Enable autoscaling
  enabled: false
  # -- Minimum replicas
  minReplicas: 2
  # -- Maximum replicas
  maxReplicas: 3
  # -- CPU target for autoscaling trigger
  targetCPUUtilizationPercentage: 70
  # -- Memory target for autoscaling trigger
  targetMemoryUtilizationPercentage: 70

metrics:
  # -- Enable prometheus metrics
  enabled: false #true
  # -- Port for prometheus metrics
  port: 2112

log:
  level: "debug"
  encoding: json

security:
  # -- by default, apps run as non-root
  runAsNonRoot: false
  # -- User used by the apps
  runAsUid: 0
  # -- Group used by the apps
  runAsGid: 0

service:
  port: 8080

vault:
  enabled: true
  injector:
    enabled: false
  server:
    args: 
      - server
      - -dev
      - -dev-root-token-id=root
      - -dev-listen-address=0.0.0.0:8200
    persistence:
      size: 5Gi

config:
  http:
    host: ""
    port: 8080
    timeout:
      idle: 120s
      read: 10s
      write: 10s
  vault:
    addr: http://vc-issuer-vault-server-headless:8200
    token: root
    key:
      supported: "ed25519,ecdsa-p256,ecdsa-p384,ecdsa-p521,rsa-2048"
      signing: ""
  authentication:
    name: keycloak
    authorizeUrl: "https://keycloak.walt-test.cloud/realms/waltid-keycloak-ktor/protocol/openid-connect/auth"
    accessTokenUrl: "https://keycloak.walt-test.cloud/realms/waltid-keycloak-ktor/protocol/openid-connect/token"
    clientId: "issuer_api"
    clientSecret: "secret"

ingress:
  enabled: true
  hosts:
    - paths:
      - path: /issuer/api
        port: 8080
        pathType: Prefix
  replacePath:
    regex: /issuer/api(/|$)(.*)
    replacement: /$2
  tls:
    - secretName: dataspace4health.local
      hosts:
        - dataspace4health.local

# istio:
#   injection:
#     pod: true
